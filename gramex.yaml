# Generated by gramex init 1.61.0 (don't delete this line)
# on 2020-07-14 by Pratap Vardhan <pratap.vardhan@gramener.com>

# Configurations for app: process-monitor
# ----------------------------------------------------------------------------
variables:
  narrative: "Modifying {{ arg }} from {{ previous }} to {{ current }} {{ outcome_verb }} the batch"
  plant_ui: template-plant.html
url:
  process-monitor/auth:
    pattern: /$YAMLURL/auth
    handler: DBAuth
    kwargs:
      template: $YAMLPATH/login.html
      url: sqlite:///$YAMLPATH/auth.sqlite3
      table: users
      user:
        column: user
      password:
        column: password
      redirect:
        query: next
        header: Referer
        url: /$YAMLURL/

  process-monitor-home:
    pattern: /$YAMLURL/
    handler: FileHandler
    kwargs:
      path: $YAMLPATH/index.html
      template: true
  narrative:
    pattern: /$YAMLURL/narrative
    handler: FunctionHandler
    kwargs:
      function: process_monitor.narrative
      # template: true
      headers:
        Content-Type: text/html
        Cache-Control: no-cache

  process-monitor-public-page:
    pattern: /$YAMLURL/(help|code)
    handler: FileHandler
    kwargs:
      path: $YAMLPATH/*.html
      template: true

  process-monitor-mobile:
    pattern: /$YAMLURL/mobile
    handler: FileHandler
    kwargs:
      path: $YAMLPATH/mobile.html
      template: true
      auth:
        login_url: /$YAMLURL/auth
        membership:
          role:
            - supervisor
            - operator
            - analyst
      headers:
        # Templates may have user-specific content. Cache privately.
        # Keep max-age small (in case we log out & log in as another user.)
        Cache-Control: private, max-age=1

  process-monitor-monitor:
    pattern: /$YAMLURL/monitor
    handler: FileHandler
    kwargs:
      path: $YAMLPATH/monitor.html
      template: true
      auth:
        login_url: /$YAMLURL/auth
        membership:
          role:
            - supervisor
            - operator
            - analyst
      headers:
        # Templates may have user-specific content. Cache privately.
        # Keep max-age small (in case we log out & log in as another user.)
        Cache-Control: private, max-age=1

  process-monitor-page:
    pattern: /$YAMLURL/(predictor|simulator)
    handler: FileHandler
    kwargs:
      path: $YAMLPATH/*.html
      template: true
      auth:
        login_url: /$YAMLURL/auth
        membership:
          role:
            - supervisor
            - operator
            - analyst
      headers:
        # Templates may have user-specific content. Cache privately.
        # Keep max-age small (in case we log out & log in as another user.)
        Cache-Control: no-store
        # cache: {expiry: {duration: 1}}

  process-monitor-data:
    pattern: /$YAMLURL/(data|datasimulate)
    handler: FormHandler
    kwargs:
      batch:
        url: $YAMLPATH/data_batch.csv
      summary:
        url: $YAMLPATH/data_summary.csv
      modify: process_monitor.classify(data, handler)

  process-monitor-classify:
    pattern: /$YAMLURL/classify
    handler: MLHandler
    kwargs:
      headers:
        Cache-Control: "no-cache, no-store"
      config_dir: $YAMLPATH
      template: mlhandler-template.html
      data:
        url: $YAMLPATH/data_input.csv
      model:
        class: LogisticRegression
        target_col: Outcome
        exclude: [Batch Number]
        cats:
          - "Material A"
          - "Material B"
          - "Solvent Amt"
          - "Catalyzer Type"
        nums:
          - "Avg Reactor Temperature"
          - "Avg Reaction Time (min)"
          - "Avg Crystallizer Cooling Rate"
          - "Avg Crystallizer Stirring Speed"
          - "Avg Dryer Cycle Time (min)"
          - "Avg Dryer Speed"
          - "Avg Dryer Temperature"
          - "Avg Crushing speed"
          - "Avg Crushing time (min)"

  process-monitor-logout:
    pattern: /$YAMLURL/logout/
    handler: LogoutHandler

# Gramex init configurations for app: process-monitor
# ----------------------------------------------------------------------------
import:
  # /ui/ has Gramex UI components -- use this like the node_modules/ directory
  ui:
    path: $GRAMEXAPPS/ui/gramex.yaml
    YAMLURL: $YAMLURL/ui/
  admin:
    path: $GRAMEXAPPS/admin2/gramex.yaml
    YAMLURL: $YAMLURL/admin/
    ADMIN_KWARGS:
      authhandler: process-monitor/auth
    ADMIN_AUTH:
      login_url: /$YAMLURL/auth
      membership:
        role: analyst
